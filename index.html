<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Recorder with Language Selection</title>
    <style>
        .container { max-width: 600px; margin: 20px auto; padding: 20px; }
        button { padding: 10px 20px; margin: 5px; }
        #preview { margin: 20px 0; }
        #result { margin-top: 20px; padding: 10px; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Audio Recorder</h1>

        <!-- Language Selection -->
        <select id="language">
            <option value="hi">Hindi</option>
            <!-- Add other languages as needed -->
        </select>

        <!-- Recording Controls -->
        <div class="controls">
            <button id="recordButton">Start Recording</button>
            <button id="stopButton" disabled>Stop & Upload</button>
        </div>

        <!-- Audio Preview -->
        <audio id="preview" controls></audio>

        <!-- Results Display -->
        <div id="result"></div>
    </div>

    <script>
        const recordButton = document.getElementById('recordButton');
        const stopButton = document.getElementById('stopButton');
        const languageSelect = document.getElementById('language');
        const preview = document.getElementById('preview');
        const resultDiv = document.getElementById('result');

        let mediaRecorder;
        let audioChunks = [];

        // Initialize recording
        recordButton.addEventListener('click', async () => {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);

                mediaRecorder.ondataavailable = event => {
                    audioChunks.push(event.data);
                };

                mediaRecorder.onstop = async () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    preview.src = URL.createObjectURL(audioBlob);
                    await uploadAudio(audioBlob);
                };

                mediaRecorder.start();
                recordButton.disabled = true;
                stopButton.disabled = false;
            } catch (err) {
                console.error('Error accessing microphone:', err);
            }
        });

        // Stop recording
        stopButton.addEventListener('click', () => {
            mediaRecorder.stop();
            recordButton.disabled = false;
            stopButton.disabled = true;
        });

        // Upload handler
        async function uploadAudio(blob) {
            const formData = new FormData();
            formData.append('audio', blob, 'recording.wav');
            formData.append('lang', languageSelect.value);

            try {
                const response = await fetch('https://indicconformer-asr-onnx.onrender.com/transcribe', { // Replace with your backend URL
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                resultDiv.textContent = `Server Response: ${result.transcription}`;
            } catch (error) {
                console.error('Upload failed:', error);
                resultDiv.textContent = 'Upload failed - check console';
            }
        }
    </script>
</body>
</html>
